# Инструкция по настройке SSH-сервера и подключению через SSH

SSH (Secure Shell) — это безопасный способ удаленного доступа к серверу. В этой инструкции мы настроим SSH-сервер, сгенерируем ключи и подключимся к серверу через SSH.

---

## 1. Установка и настройка SSH-сервера

### 1.1 Установка OpenSSH-сервера

Для установки OpenSSH-сервера выполните следующие команды в зависимости от вашего дистрибутива.

- **Для Ubuntu/Debian:**
  ```bash
  sudo apt update
  sudo apt install openssh-server
  ```

### 1.2 Запуск и проверка SSH-сервера

- **Запустите SSH-сервер:**
  ```bash
  sudo systemctl start ssh
  ```

- **Настройте автозапуск SSH при старте системы:**
  ```bash
  sudo systemctl enable ssh
  ```

- **Проверьте статус SSH-сервера:**
  ```bash
  sudo systemctl status ssh
  ```

### 1.3 Конфигурация SSH-сервера

Отредактируйте файл конфигурации SSH для изменения настроек (например, отключение аутентификации по паролю).

- Откройте файл:
  ```bash
  sudo nano /etc/ssh/sshd_config
  ```

- Чтобы отключить аутентификацию по паролю, измените строку:
  ```bash
  PasswordAuthentication no
  ```

- Перезапустите SSH-сервер для применения изменений:
  ```bash
  sudo systemctl restart ssh
  ```

---

## 2. Генерация SSH-ключей

SSH-ключи используются для безопасной аутентификации без пароля.

### 2.1 Генерация ключей с помощью `ssh-keygen`

На локальной машине выполните команду для генерации пары ключей (приватного и публичного):

```bash
ssh-keygen
```

- Укажите путь для сохранения ключей (по умолчанию — `~/.ssh/id_rsa`).
- При необходимости установите пароль для ключа (можно оставить пустым).

### 2.2 Просмотр сгенерированных ключей

После генерации ключей, они будут храниться в каталоге `~/.ssh/`:

- **Приватный ключ** — `id_rsa`
- **Публичный ключ** — `id_rsa.pub`

### 2.3 Копирование публичного ключа на сервер

Чтобы использовать ключи для аутентификации, нужно скопировать публичный ключ на сервер. Это можно сделать с помощью команды `ssh-copy-id`:

```bash
ssh-copy-id username@server_ip
```

Введите пароль пользователя на сервере при запросе.

Если `ssh-copy-id` не доступна, скопируйте содержимое файла `~/.ssh/id_rsa.pub` вручную и добавьте его в файл `~/.ssh/authorized_keys` на сервере.

---

## 3. Подключение к серверу через SSH

### 3.1 Подключение с использованием пароля

Если аутентификация по паролю включена, можно подключиться с помощью:

```bash
ssh username@server_ip
```

### 3.2 Подключение с использованием SSH-ключа

После настройки публичного ключа для аутентификации, подключитесь к серверу без ввода пароля:

```bash
ssh username@server_ip
```

Если ваш приватный ключ хранится в другом файле, укажите его с помощью параметра `-i`:

```bash
ssh -i /path/to/private_key username@server_ip
```

---

## 4. Настройка `authorized_keys` на сервере

Чтобы сервер знал, какие публичные ключи разрешены для подключения, они должны быть в файле `~/.ssh/authorized_keys`.

### 4.1 Добавление ключа вручную

1. Подключитесь к серверу.
2. Создайте каталог `.ssh` и файл `authorized_keys`:
   ```bash
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh
   nano ~/.ssh/authorized_keys
   ```

3. Вставьте содержимое вашего публичного ключа (`id_rsa.pub`) в файл `authorized_keys` и сохраните.

4. Установите правильные права для файла:
   ```bash
   chmod 600 ~/.ssh/authorized_keys
   ```

---

## 5. Дополнительные настройки безопасности

### 5.1 Отключение пароля для аутентификации

Для повышения безопасности можно отключить аутентификацию по паролю. Для этого в файле конфигурации `/etc/ssh/sshd_config` установите:

```bash
PasswordAuthentication no
```

Затем перезапустите SSH-сервер:

```bash
sudo systemctl restart ssh
```

---

Теперь вы настроили SSH-сервер, создали ключи и настроили безопасное подключение без пароля.
